[首页](/index.md) << ... << [索引](index.md)

# shell中的双中括号[[]]
shell中的双中括号[[是bash程序语言的关键字。并不是一个命令（单中括号是一个命令）。

双中括号不会对变量进行单词分离。所以当变量的值中有空格时，不需要像单中括号那样，将变量引用使用双引号引起来。

支持字符串的模式匹配，使用=~操作符时甚至支持shell的正则表达式。字符串比较时可以把右边的作为一个模式，而不仅仅是一个字符串，比如[[ hello == hell? ]]，结果为真。[[ ]] 中匹配字符串或通配符，不需要引号，这种情况下字符串就是模式来的，如果它里面有含有SHELL元字符，BASH会对它进行扩展。如果字符串加了双引号，那它就是一个很普通的字符串的，即便字符串里面里面含有特殊字符，也就是当普通内容来处理。例如：
```
[root@www yansan]# name=tomm
[root@www yansan]# [[ $name == tom ]]
[root@www yansan]# echo $?          
1
[root@www yansan]# [[ $name == tom? ]]
[root@www yansan]# echo $?           
0
[root@www yansan]# [[ $name == "tom" ]]
[root@www yansan]# echo $?             
1
[root@www yansan]# [[ $name == "tom?" ]]
[root@www yansan]# echo $?             
1
```
上面的表达式`[[ $name == "tom?" ]]`，因为`tom?`被双引号引起来了，所以问号“?”变成了一个普通的字符串，而不会进行模式匹配。

使用[[ ... ]]条件判断结构，而不是[ ... ]，能够防止脚本中的许多逻辑错误。比如，&&、||、<和> 操作符能够正常存在于[[ ]]条件判断结构中，但是如果出现在[ ]结构中的话，会报错。比如可以直接使用if [[ $a != 1 && $a != 2 ]],如果不适用双括号, 则为if [ $a -ne 1] && [ $a != 2 ]或者if [ $a -ne 1 -a $a != 2 ]

bash把双中括号中的表达式看作一个单独的元素，并返回一个退出状态码。

## 疑问列表
1. 双中括号中，为什么不支持 >=、<=比较运算符？

## 语法
    [[ exp ]]
注意：
1. 中括号的两边和exp之间必须有空格分开。
2. 双中括号的条件判断
3. 双中括号的多个条件判断即使用“&&”或“||”连接，作用与单中括号中的“-a”和“-o”相同

## 用于字符串比较
### 示例
+ 示例代码
```
#!/bin/bash
# desc: double bracket demo
# author: setamv
# created: 2019-02-05

# 初始化变量
a=1
b=2

s1='abc d'
s2='def'

# 比较字符串
echo '--------------比较字符串-----------------------'
[[ $s1 == 'abc d' ]]
echo $?

echo '--------------字符串比较：模式匹配---------------'
[[ $s1 == abc* ]]
echo $?
```
+ 执行结果
```
[root@centos-7-192 shell]# ./double_bracket.sh 
--------------比较字符串-----------------------
0
--------------字符串比较：模式匹配---------------
0
```

## 用于条件判断
双中括号可用于条件判断，其支持的条件判断符号包括：
+ ! : 条件非。
+ == : 等于比较。应用于整型或字符串的比较。字符串支持模式匹配。也可以使用单等号“=”替换。
+ != : 不等于比较。应用于整型或字符串的比较
+ < : 小于比较。应用于整型比较
+ > : 大于比较。应用于整型比较
+ <= : 小于或等于比较。应用于整型比较。不支持？
+ >= : 大于或等于比较。应用于整型比较。不支持？
+ && : 双方都成立（and）。例如：逻辑表达式 && 逻辑表达式
+ || : 单方成立（or）。例如：逻辑表达式 || 逻辑表达式

+ -f : 判断文件是否存在。例如：if [ -f filename ]
+ -d : 判断目录是否存在。例如：if [ -d dir ]
+ -eq : 等于比较。应用于整型比较。
+ -ne : 不等于比较。应用于整型比较
+ -lt : 小于比较。应用于整型比较
+ -gt : 大于比较。应用于整型比较
+ -le : 小于或等于比较。应用于整型比较
+ -ge : 大于或等于比较。应用于整型比较
+ -z : 空字符串。以下情况将视变量`a`为空字符串：1）变量a不存在；2）a=''；3）a=' '；4）a='   '（里面包含tab符号）；
+ -n : 非空字符串。只有以下情况将变量`a`为空字符串：1）a=''。注意，当变量a未定义时，[ -n $a ] 也是true。

注意：双中括号不支持单中括号中的`-o`、`-a`

### 示例
+ 示例代码
```
#!/bin/bash
# desc: double bracket demo
# author: setamv
# created: 2019-02-05

# 初始化变量
a=1
b=2

s1='abc d'
s2='def'

# 比较字符串
echo '--------------比较字符串-----------------------'
[[ $s1 == 'abc d' ]]
echo $?

echo '--------------字符串比较：模式匹配---------------'
[[ $s1 == abc* ]] 
echo $?

# 整型值比较
echo '--------------整型值比较：== -----------------------'
[[ $a == 1 ]] 
echo $?

echo '--------------整形比较：-eq ---------------------'
[[ $a -eq 1 ]]
echo $?

echo '--------------非运算符：! -----------------------'
[[ ! $a == 2  ]]
echo $?

echo '--------------整型值比较：> ------------------------'
[[ $a > 0 ]]
echo $?

echo '--------------整型值比较：-gt ----------------------'
[[ $a -gt 0 ]]
echo $?

echo '--------------整型值比较：>= ------------------------'
#[[ $a <= 0 ]] 
#echo $?

echo '--------------整型值比较：-ge ----------------------'
[[ $a -ge 0 ]]
echo $?

echo '--------------逻辑运算符：&& ||--------------------'
[[ $a == 1 && $b == 2 ]] 
echo "a==1 && b==2 ? $?"


echo '-------------测试文件是否存在：-f --------------'
[[ -f /root/shell/for.sh ]]
echo $?


echo '--------------单中括号和双中括号混用---------------'
[[ $a == 1 ]] && [ $b -eq 2 ] 
echo $?
```

+ 执行结果
```
--------------比较字符串-----------------------
0
--------------字符串比较：模式匹配---------------
0
--------------整型值比较：== -----------------------
0
--------------整形比较：-eq ---------------------
0
--------------非运算符：! -----------------------
0
--------------整型值比较：> ------------------------
0
--------------整型值比较：-gt ----------------------
0
--------------整型值比较：>= ------------------------
--------------整型值比较：-ge ----------------------
0
--------------逻辑运算符：&& ||--------------------
a==1 && b==2 ? 0
-------------测试文件是否存在：-f --------------
0
--------------单中括号和双中括号混用---------------
0
```